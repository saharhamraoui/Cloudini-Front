<div class="medical-records-container">
 <!-- Premium Hero Section -->
<div class="medical-hero">
  <div class="hero-content">
    <h1><i class="fas fa-file-medical"></i> Medical Records</h1>
    <p>Secure access to your complete health history in one place</p>
  </div>
  <div class="hero-decoration">
    <div class="decoration-circle"></div>
    <div class="decoration-wave"></div>
    <div class="floating-icons">
      <i class="fas fa-stethoscope"></i>
      <i class="fas fa-prescription-bottle-alt"></i>
      <i class="fas fa-heartbeat"></i>
      <i class="fas fa-file-alt"></i>
    </div>
  </div>
</div>

  
  <!-- Records List -->
  <div class="records-list-container glass-effect">
    <div class="list-header">
      <h2><i class="fas fa-clipboard-list"></i> Your Medical History</h2>
      <div class="list-controls">
        <button class="btn-add-record glass-effect" *ngIf="currentUser.role === 'MEDECIN'" (click)="onShowAddForm()">
          <i class="fas fa-plus-circle"></i> New Record
        </button>
        <div class="search-records">
          <i class="fas fa-search"></i>
          <input type="text" [(ngModel)]="searchTerm" (input)="onSearch()" placeholder="Search records...">
          <button class="search-btn">
            <i class="fas fa-search"></i>
          </button>
        </div>
        <div class="filter-records">
          <div class="select-wrapper">
            <select [(ngModel)]="dateFilter" (change)="applyFilters()">
              <option value="">All Time</option>
              <option value="today">Today</option>
              <option value="week">This Week</option>
              <option value="month">This Month</option>
              <option value="year">This Year</option>
            </select>
            <i class="fas fa-chevron-down"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading your medical records...</p>
    </div>

    <!-- Records Cards -->
    <div class="records-cards">
     <div *ngFor="let record of filteredRecords" [@cardAnimation] class="record-card glass-effect">
        <div class="card-header">
          <div class="record-title">
            <h3>Record #{{record.idMedicalRecord}}</h3>
            <span class="record-date">
              <i class="fas fa-calendar-alt"></i> {{record.createdAt | date:'mediumDate'}}
            </span>
          </div>
        </div>
        
        <div class="card-body">
          <div class="record-details">
            <div class="detail-item">
              <label>Diagnosis</label>
              <p>{{record.diagnosis || 'Not specified'}}</p>
            </div>
            <div class="detail-item">
              <label>Allergies</label>
              <p>{{record.allergies || 'None recorded'}}</p>
            </div>
          </div>
          
          <div class="record-notes">
            <label>Notes</label>
            <p>{{record.notes || 'No additional notes'}}</p>
          </div>
        </div>
        
        <div class="card-actions">
          <button class="action-btn view" (click)="viewRecordDetails(record)">
            <i class="fas fa-eye"></i> View Details
          </button>
          <button class="action-btn download" (click)="downloadPDF(record)">
            <i class="fas fa-download"></i> Download
          </button>
          <button class="action-btn prescriptions" (click)="openPrescriptionsModal(record.idMedicalRecord!)">
            <i class="fas fa-prescription-bottle-alt"></i> Prescriptions
          </button>
          <button class="action-btn bilan" (click)="openBilanUploadModal(record.idMedicalRecord!)">
            <i class="fas fa-file-upload"></i> Upload Bilan
          </button>
          <button class="action-btn bilan-list" (click)="openBilanListModal(record.idMedicalRecord!)">
            <i class="fas fa-file-alt"></i> View Bilans
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredRecords.length === 0 && !isLoading" class="empty-records">
      <div class="empty-icon">
        <i class="fas fa-file-medical"></i>
      </div>
      <h3>No medical records found</h3>
      <p>We couldn't find any records matching your search</p>
      <button class="reset-btn glass-effect" (click)="resetFilters()">Reset Filters</button>
    </div>
  </div>

  <!-- Record Detail Modal -->
  <div class="modal-overlay" *ngIf="selectedRecord">
    <div class="record-modal glass-effect">
      <div class="modal-header">
        <h3>
          <i class="fas fa-file-medical-alt"></i> 
          Medical Record Details
        </h3>
        <button class="close-modal" (click)="selectedRecord = null">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="record-details">
          <div class="detail-row">
            <div class="detail-label">Record ID</div>
            <div class="detail-value">#{{selectedRecord.idMedicalRecord}}</div>
          </div>
          
          <div class="detail-row">
            <div class="detail-label">Date Created</div>
            <div class="detail-value">{{selectedRecord.createdAt | date:'fullDate'}}</div>
          </div>
          
          <div class="detail-row">
            <div class="detail-label">Doctor</div>
            <div class="detail-value">Dr. {{selectedRecord.doctor.firstName}} {{selectedRecord.doctor.lastName}}</div>
          </div>
          
          <div class="detail-row">
            <div class="detail-label">Diagnosis</div>
            <div class="detail-value">{{selectedRecord.diagnosis || 'Not specified'}}</div>
          </div>
          
          <div class="detail-row">
            <div class="detail-label">Allergies</div>
            <div class="detail-value">{{selectedRecord.allergies || 'None recorded'}}</div>
          </div>
          
          <div class="detail-row">
            <div class="detail-label">Notes</div>
            <div class="detail-value">{{selectedRecord.notes || 'No additional notes'}}</div>
          </div>
        </div>
       
        <div class="modal-actions">
          <button class="modal-btn download" (click)="downloadPDF(selectedRecord)">
            <i class="fas fa-file-pdf"></i> Download PDF
          </button>
          <button class="modal-btn close" (click)="selectedRecord = null">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Record Modal -->
  <div class="modal-overlay" *ngIf="isAddFormVisible">
    <div class="modal-container glass-effect">
      <div class="modal-header">
        <h3><i class="fas fa-file-medical"></i> Create New Medical Record</h3>
        <button class="close-modal" (click)="closeAddForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <form (ngSubmit)="addRecord()" #addRecordForm="ngForm" class="record-form">
          <div class="form-group">
            <label>Diagnosis*</label>
            <input type="text" class="form-control" [(ngModel)]="newRecord.diagnosis" name="diagnosis" 
                   placeholder="Enter diagnosis" required>
          </div>
          
          <div class="form-group">
            <label>Notes</label>
            <textarea class="form-control" [(ngModel)]="newRecord.notes" name="notes" 
                      rows="5" placeholder="Additional notes"></textarea>
          </div>
          
          <div class="form-group">
            <label>Allergies</label>
            <input type="text" class="form-control" [(ngModel)]="newRecord.allergies" name="allergies" 
                   placeholder="List any allergies">
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-cancel" (click)="closeAddForm()">Cancel</button>
            <button type="submit" class="btn-save" [disabled]="!addRecordForm.valid">
              <i class="fas fa-plus-circle"></i> Save Record
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Prescriptions Modal -->
  <div class="modal-overlay" *ngIf="showPrescriptionsModal">
    <div class="record-modal glass-effect">
      <div class="modal-header">
        <h3>
          <i class="fas fa-prescription-bottle-alt"></i> 
          Prescriptions for Record #{{currentRecordId}}
        </h3>
        <button class="close-modal" (click)="closePrescriptionsModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div *ngIf="currentPrescriptions.length === 0" class="empty-prescriptions">
          <i class="fas fa-prescription-bottle"></i>
          <p>No prescriptions found for this record</p>
        </div>

        <div *ngIf="currentPrescriptions.length > 0" class="prescriptions-list">
          <div *ngFor="let prescription of currentPrescriptions" class="prescription-item glass-effect">
            <div class="prescription-header">
              <h4>{{prescription.medication}}</h4>
              <span class="status-badge" [ngClass]="{
                'status-active': prescription.status === 'ACTIVE',
                'status-completed': prescription.status === 'COMPLETED',
                'status-expired': prescription.status === 'EXPIRED',
                'status-pending': prescription.status === 'PENDING'
              }">
                {{prescription.status}}
              </span>
            </div>
            
            <div class="prescription-details">
              <div class="detail-row">
                <span class="detail-label">Dosage:</span>
                <span class="detail-value">{{prescription.dosage}}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Instructions:</span>
                <span class="detail-value">{{prescription.instructions}}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Issue Date:</span>
                <span class="detail-value">{{prescription.issueDate | date:'mediumDate'}}</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="modal-btn close" (click)="closePrescriptionsModal()">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bilan Upload Modal -->
  <div class="modal-overlay" *ngIf="showBilanUploadModal">
    <div class="record-modal glass-effect">
      <div class="modal-header">
        <h3>
          <i class="fas fa-file-upload"></i> 
          Upload Bilan for Record #{{currentRecordId}}
        </h3>
        <button class="close-modal" (click)="closeBilanUploadModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <app-bilan-upload 
          [medicalRecordId]="currentRecordId" 
          (bilanUploaded)="onBilanUploaded()">
        </app-bilan-upload>
        
        <div class="modal-actions">
          <button class="modal-btn close" (click)="closeBilanUploadModal()">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bilan List Modal -->
  <div class="modal-overlay" *ngIf="showBilanListModal">
    <div class="record-modal glass-effect">
      <div class="modal-header">
        <h3>
          <i class="fas fa-file-alt"></i> 
          Bilans for Record #{{currentRecordId}}
        </h3>
        <button class="close-modal" (click)="closeBilanListModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <app-bilan-list 
          [medicalRecordId]="currentRecordId" >
        </app-bilan-list>
        
        <div class="modal-actions">
          <button class="modal-btn close" (click)="closeBilanListModal()">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

