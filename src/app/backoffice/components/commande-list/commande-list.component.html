<app-header-back></app-header-back>
<div class="container mt-4">
  
<!-- Filtre par statut -->
<div class="d-flex justify-content-end mb-3">
  <select class="form-select w-auto" [(ngModel)]="statusFilter">
    <option value="">statuts</option>
    <option value="Encours">En cours</option>
    <option value="Validée">Validée</option>
    <option value="Livrée">Livrée</option>
  </select>
</div>

  <h2 class="text-center mb-4">Orders</h2>

  <!-- Aucune commande -->
  <div *ngIf="commandes.length === 0" class="alert alert-info text-center">
    No orders available.
  </div>

  <!-- Liste des commandes -->
  <div *ngFor="let commande of commandes | statusFilter: statusFilter" class="card mb-4 shadow-sm">


    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Order #{{ commande.idcommande }} — <span class="badge"
        [ngClass]="{
          'bg-warning text-dark': commande.status === 'Encours',
          'bg-success': commande.status === 'Livrée',
          'bg-info text-dark': commande.status === 'Validée'
        }">
    {{ commande.status }}
  </span>
  </h5>
    </div>

    <div class="card-body">
      <p><strong>Supplier :</strong> {{ commande.fournisseur.nom }}</p>
      <p><strong>Contact :</strong> {{ commande.fournisseur.contact }}</p>
      <p><strong>Adress :</strong> {{ commande.fournisseur.adresse }}</p>
      <p><strong>Order Date :</strong> {{ commande.dateCommande | date: 'short' }}</p>
      <h6 class="mt-3">Ordred Medications:</h6>
      <div class="table-responsive">
        <table class="table table-bordered table-striped">
          <thead class="table-secondary">
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Quantity</th>
              <th>Price per uni</th>
              <th>total Price</th>
              <th>expiration Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let ligne of commande.lignesCommande">
              <td>{{ ligne.medicament.nom }}</td>
              <td>{{ ligne.medicament.description }}</td>
              <td>{{ ligne.quantite }}</td>
              <td>{{ ligne.medicament.prix | currency:'EUR' }}</td>
              <td>{{ (ligne.medicament.prix * ligne.quantite) | currency:'EUR' }}</td>
              <td>{{ ligne.medicament.dateExpiration | date:'shortDate' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
<!-- Bouton Annuler (visible uniquement si la commande est en cours) -->
<div class="mt-3 text-end" *ngIf="commande.status === 'Encours'">
  <button class="btn btn-outline-danger" (click)="annulerCommande(commande.idcommande)">
    <i class="bi bi-x-circle"></i> Cancel Order
  </button>
</div>
<!-- Bouton Suivre l'état -->
<div class="mt-2 text-end" *ngIf="commande.status === 'Encours' || commande.status === 'Validée'">
  <button class="btn btn-primary" [routerLink]="['/back/suivi-etat', commande.idcommande]">
    <i class="bi bi-eye"></i> Status etat
  </button>
</div>



      <!-- Prix total de la commande -->
      <div class="text-end mt-3">
        <strong>Total Orders:</strong>
        <span class="text-success fs-5">
          {{ getTotalPrixCommande(commande) | currency:'EUR' }}
        </span>
      </div>
    </div>
  </div>
</div>
