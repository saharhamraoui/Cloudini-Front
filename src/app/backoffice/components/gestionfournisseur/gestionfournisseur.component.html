
<app-header-back></app-header-back>
<div class="container mt-4">
  <div class="card p-4">
    <h3 class="mb-4">{{ isEditMode ? 'Edit Supplier' : 'Add Supplier' }}</h3>

    <form [formGroup]="fournisseurForm" (ngSubmit)="isEditMode ? updateFournisseur() : addFournisseur()">
      <div class="row">
        <div class="col-md-6">
          <div class="form-group mb-3">
            <label for="nom">Name</label>
            <input type="text" class="form-control" id="nom" formControlName="nom">
            <div class="text-danger" *ngIf="fournisseurForm.get('nom')?.invalid && (fournisseurForm.get('nom')?.dirty || fournisseurForm.get('nom')?.touched)">
              name required
            </div>
          </div>

          <div class="form-group mb-3">
            <label for="contact">Email</label>
            <input type="email" class="form-control" id="contact" formControlName="contact">
            <div *ngIf="fournisseurForm.get('contact') as contactCtrl">
              <div class="text-danger" *ngIf="contactCtrl.invalid && (contactCtrl.dirty || contactCtrl.touched)">
                <div *ngIf="contactCtrl.errors?.['required']">contact required.</div>
                <div *ngIf="contactCtrl.errors?.['email']">you should enter a valid email adress</div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group mb-3">
            <label for="adresse">Adress (click the map)</label>
            <input type="text" class="form-control" id="adresse" formControlName="adresse" readonly>
          </div>
          <div id="map" class="map-container"></div>
        </div>
      </div>

      <button type="submit" class="btn btn-primary mt-3" [disabled]="fournisseurForm.invalid">
        {{ isEditMode ? 'UPDATE' : 'ADD' }}
      </button>
    </form>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="success-message">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>
  <div class="card mt-4 p-3">
    <h4>Supplier</h4>
    <ul class="list-group mt-2">
      <li *ngFor="let fournisseur of fournisseurs" class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <strong>{{ fournisseur.nom }}</strong><br>
          {{ fournisseur.adresse }}<br>
          {{ fournisseur.contact }}
        </div>
        <div>
          <button class="btn btn-warning btn-sm me-2" (click)="editFournisseur(fournisseur)">Modify</button>
          <button class="btn btn-danger btn-sm" (click)="deleteFournisseur(fournisseur.idfournisseur)">Delete</button>
        </div>
      </li>
    </ul>
  </div>
</div>
